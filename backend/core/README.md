# Bloom Backend Services

This package is a [NestJS application](https://docs.nestjs.com/) that provides a core set of backend services via REST API endpoints to apps using the Bloom Housing framework. Information is stored in a Postgres database, accessed via [TypeORM](https://typeorm.io/).

## OpenAPI Documentation

OpenAPI (fka Swagger) documentation is automatically generated by the server at `http://localhost:3100/docs/` for a standard local development environment. A raw JSON version of the schema is also available at `/docs-json/`, suitable for API client code generation or other code-based consumers.

## Getting Started for Developers

The following steps should provide a working local environement for development purposes:

### Setting up your local environment variables

Operational configuration the service is read from environment variables. Copy `.env.template` to `.env` and edit the settings specific to your development environment. Make sure the Database URL matches your Postgres configuration.

### Setting up a Database

There are two databases used in this project: `bloom` and `bloom_test`. First is used every time  you are starting a project with `yarn dev` and second one is only used in end-to-end tests. Corresponding TypeORM configs are defined in `ormconfig.ts` and `ormconfig.test.ts`.
If you are just starting to work with the projects it's best to simply run:

```shell script
yarn && yarn reseed:db
```

that will create `bloom` DB for you, migrate it to the latest schema and seed with appropriate dev data.

Dropping the DB:

```shell script
yarn db:drop
```

Creating the DB:

```shell script
yarn db:create
```

Seeding the DB:
```shell script
yarn db:seed
```

Generating a new migration:
```shell script
yarn db:migration:generate
```

Applying migrations:
```shell script
yarn db:migration:run
```

### Running Tests

End-to-end tests:

```shell script
yarn test:e2e:local
```

Unit tests:

```shell script
yarn test
```



